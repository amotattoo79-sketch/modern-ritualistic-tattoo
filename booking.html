<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Termin – Modern Ritualistic Tattoo</title>
  <link rel="stylesheet" href="style.css">

  <!-- Nur CSS: unkritisch für DSGVO, sorgt dafür, dass das Widget sichtbar gestylt ist -->
  <link rel="stylesheet" href="https://assets.calendly.com/assets/external/widget.css">
</head>
<body>
<header>
  <h1>Modern Ritualistic Tattoo</h1>
  <nav>
    <a href="index.html">Home</a> |
    <a href="philosophie.html">Philosophie</a> |
    <a href="angebote.html">Angebote &amp; Preise</a> |
    <a href="gallery.html">Galerie</a> |
    <a href="contact.html">Kontakt</a> |
    <a href="booking.html" aria-current="page">Termin</a> |
    <a href="impressum.html">Impressum</a> |
    <a href="datenschutz.html">Datenschutz</a>
  </nav>
</header>

<main class="content narrow">
  <h2>Termin buchen</h2>
  <p>Der Kalender wird erst nach deiner Zustimmung geladen (DSGVO-konform).</p>

  <section id="consent-box" class="card" style="margin-top:1rem">
    <p>
      Mit Klick auf „Kalender laden“ werden Inhalte von Calendly (externer Anbieter)
      geladen. Dabei können personenbezogene Daten (z. B. IP-Adresse) übertragen werden.
      Details in der <a href="datenschutz.html">Datenschutzerklärung</a>.
    </p>
    <button id="loadCalendly" type="button" class="btn">Kalender laden</button>
  </section>

  <!-- Zielcontainer -->
  <div id="calendly-container" style="display:none;min-height:820px"></div>
</main>

<footer>
  <p>© <span id="year"></span> Modern Ritualistic Tattoo</p>
</footer>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  const CAL_URL = "https://calendly.com/amotattoo79/30min?hide_gdpr_banner=1";
  const consentBox = document.getElementById('consent-box');
  const container  = document.getElementById('calendly-container');
  const btn        = document.getElementById('loadCalendly');

  function ensureInline(div) {
    // Falls das Inline-Widget allein durch data-url gerendert wird, lassen wir es zu;
    // ansonsten initialisieren wir aktiv:
    if (window.Calendly && window.Calendly.initInlineWidget) {
      window.Calendly.initInlineWidget({ url: CAL_URL, parentElement: div });
    }
  }

  function loadCalendly() {
    consentBox.style.display = 'none';
    container.style.display  = 'block';

    // Widget-Div anlegen
    const inline = document.createElement('div');
    inline.className = 'calendly-inline-widget';
    inline.style.minWidth = '320px';
    inline.style.height   = '800px';
    inline.setAttribute('data-url', CAL_URL);
    container.appendChild(inline);

    // Wenn Skript schon da ist: sofort initialisieren
    if (window.Calendly) {
      ensureInline(inline);
      return;
    }

    // Andernfalls Script nachladen und dann initialisieren
    const s = document.createElement('script');
    s.src = 'https://assets.calendly.com/assets/external/widget.js';
    s.async = true;
    s.onload = () => ensureInline(inline);
    document.body.appendChild(s);

    // Fallback: falls onload nicht feuert (Safari-Eigenheiten)
    let tries = 0;
    const iv = setInterval(() => {
      tries++;
      if (window.Calendly) {
        clearInterval(iv);
        ensureInline(inline);
      }
      if (tries > 40) clearInterval(iv); // ~8s Timeout
    }, 200);
  }

  btn.addEventListener('click', loadCalendly);
</script>
</body>
</html>
